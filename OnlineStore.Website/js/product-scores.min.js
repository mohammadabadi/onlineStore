function clearForm(){$text.val("");$btnSend.remove()}function sendScore(n,t){var i=$(staticTemplates.Loading);$sendScore.append(i);$.ajax({type:"POST",url:"/Products/SendScore",data:{ID:productid,ScoreParameters:n,Values:t,Text:$text.val()},success:function(n){n.Success?(toastr.success("امتیاز شما برای محصول "+productname+" با موفقیت ارسال شد.","امتیاز محصول "+productname),clearForm()):toastr.error(staticTexts.ResponseError,"امتیاز محصول "+productname)},error:function(){toastr.error(staticTexts.RequestError,"امتیاز محصول "+productname)},complete:function(){i.remove();getUserScores()}})}function getUserScores(){$.ajax({type:"POST",url:"/Products/GetScoreValues",data:{ID:productid},success:function(n){var t,i,r;if(n.Success)if(n.Data!=null)for($text.val(n.Data.Text),$text.attr("disabled","disabled"),$btnSend.remove(),$parameters.find("select").barrating({theme:"bars-movie"}),t=0;t<n.Data.ScoreValues.length;t++)i=n.Data.ScoreValues,r=$parameters.find("#Parameter"+i[t].ScoreParameterID),r.barrating("set",i[t].Rate),r.barrating("readonly",!0);else $parameters.find("select").barrating({theme:"bars-movie",readonly:!1});else toastr.error(staticTexts.ResponseError,"امتیاز محصول "+productname)},error:function(){toastr.error(staticTexts.RequestError,"امتیاز محصول "+productname)}})}function bindScoreComments(){$comments.find("select").barrating({theme:"bars-movie",readonly:!0});$comments.find("select").each(function(){var n=$(this);n.barrating("set",n.data("rate"))})}function showAverage(){$average.find("select").barrating({theme:"bars-movie",readonly:!0});$average.find("select").each(function(){var n=$(this),t=n.data("rate");n.barrating("set",parseInt(t));n.find("+div div.br-current-rating").text(t)})}function evaluationProductComment(n,t,i){var r=$(staticTemplates.Loading);i.append(r);$.ajax({type:"POST",url:"/Products/EvaluationProductComment",data:{CommentID:n,IsLikeClick:t},success:function(t){if(t.Success){var i=$commentItems.find("div[data-id="+n+"]");i.find("span.like-count").text(t.Data.LikesCount);i.find("span.dislike-count").text(t.Data.DisLikesCount)}},error:function(){toastr.error(staticTexts.RequestError,"ارزیابی نظر "+productname)},complete:function(){r.remove()}})}var $sendScore=$("#SendScore"),productid=$(".product-details").data("productid"),$text=$("#SendScore #Text"),$btnSend=$("#SendScore .btn-submit"),$parameters=$("#SendScore .score-parameter"),$comments=$(".score-comments .score-parameter"),$average=$(".average .score-parameter"),$totalScore=$(".product-shop #totalScore"),$commentItems=$(".score-comments .comment-item"),productname=$(".product-features h1 .title-fa").text(),values=[],items=[];getUserScores();showAverage();bindScoreComments();$btnSend.on("click",function(n){if(n.preventDefault(),$text.val()==""){toastr.error("لطفا متن نظر خود را وارد نمایید.","امتیاز محصول "+productname);return}$parameters.children("li").each(function(){var n=$(this);items.push(n.find("select").data("id"));values.push(n.find(".br-current").data("rating-value"))});sendScore(items.join(","),values.join(","))});$commentItems.on("click","#btnLike",function(){if(!isAuthenticated){toastr.warning('کاربر گرامی، جهت امتیازدهی لطفا <a href="/Login">وارد سایت<\/a> شوید.',"ارزیابی نظر "+productname);return}var n=$(this),t=n.closest(".comment-rates").data("id"),i=n.closest(".comment-item");evaluationProductComment(t,!0,i)});$commentItems.on("click","#btnDisLike",function(){if(!isAuthenticated){toastr.warning('کاربر گرامی، جهت امتیازدهی لطفا <a href="/Login">وارد سایت<\/a> شوید.',"ارزیابی نظر "+productname);return}var n=$(this),t=n.closest(".comment-rates").data("id"),i=n.closest(".comment-item");evaluationProductComment(t,!1,i)});
$(function(){function et(){w.raty({half:!0,readOnly:!1,score:function(){return $(this).attr("data-score")},click:function(n){var i=$(this),t=$(staticTemplates.Loading);i.append(t);$.ajax({type:"POST",url:"/Products/InsertRate",data:{ProductID:r,Rate:n},success:function(n){n.Success?(toastr.success("با تشکر از امتیاز شما","امتیازدهی"),it.text(n.Data.CountScore),rt.text(n.Data.TotalScore)):n.Errors[0]=="Repeat"&&toastr.error("قبلا برای این محصول امتیاز ثبت کرده اید! ","امتیازدهی")},error:function(){toastr.error(staticTexts.RequestError,"امتیازدهی")},complete:function(){t.remove();w.raty({readOnly:!0,score:function(){return n}})}})}})}var k=$(".product-view .price-box").html(),d=$(".product-availability-box"),y=$(".product-varients .row"),g=$(".product-tabs"),e=$(".product-controls"),p='<div class="product-available"><i class="fa fa-check-circle"><\/i> موجود<\/div>',nt='<div class="product-unavailable"><i class="fa fa-times-circle"><\/i> عدم موجودی<\/div>',n=$(".product-tabs .box-header"),h=$(".product-tabs .box-content"),c=$("#TabBoxes"),tt=$(".product-firstcomment"),w=$(".product-details .rate-comment .rate"),r=$(".product-details").data("productid"),it=$(".count-score"),rt=$(".total-score"),ut=$(".btn-add-request"),l=$(".add-request-form"),t=$(".req-email"),u=$(".req-mobile"),a=$(".req-description"),o=$(".btn-send-request"),b=$("#SendFriendForm"),f=$("#SendFriendForm #FriendEmail"),v=$("#SendFriendForm #Message"),s=$(".btn-send-friend"),ft=$(".btn-send-to-friend"),i=$(".product-title h1").text();et();$(".cloudzoom").CloudZoom({zoomPosition:12});$(".cloudzoom-gallery").CloudZoom();$("#ProductGallery").Thumbelina({$bwdBut:$("#ProductGallery .left"),$fwdBut:$("#ProductGallery .right")});h.children("div").each(function(){var t=$(this),i=t.find("h2"),r=i.clone();r.find("span").remove();n.append('<a href="#'+t.attr("ID")+'">'+r.text()+"<\/a>");i.addClass("hide")});n.append('<div class="clear"><\/div>');n.children("a:first").addClass("selected");h.children("div:first").show();$(window).resize();$(".attr-op").on("click",function(n){var u,t;n.preventDefault();var o=$(this),h=$(".product-price-box"),i="",r="";if(!o.hasClass("disabled")){o.addClass("selected").siblings(".attr-op").removeClass("selected");var s=[],f=$(".attr-op.selected"),e=$(".attr-op:not(.selected)");e=_.reject(e,function(n){return $(n).siblings(".selected").length});f.length!=y.length?(u=productVarients,f.each(function(){var n=$(this),t=n.closest(".row").data("attributeid"),i=n.data("optionid");u=_.reject(u,function(n){var r=_.where(n.Attributes,{AttributeID:t,AttributeOptionID:i});return r.length?!1:!0})}),_.each(e,function(n){var i=$(n),r=i.data("optionid"),t=!1;_.each(u,function(n){t||(t=_.where(n.Attributes,{AttributeOptionID:r}).length?!0:!1)});t?i.removeClass("disabled"):i.addClass("disabled")}),i=k,r=p):(f.each(function(){var n=$(this),t=n.closest(".row").data("attributeid"),i=n.data("optionid");s.push(t+","+i)}),_.each(productVarients,function(n){var i=!0;_.each(n.Attributes,function(n){s.indexOf(n.AttributeID+","+n.AttributeOptionID)==-1&&(i=!1)});i&&(t=n)}),t?(i=t.DiscountPercent>0?'<div class="row">    <div class="price-discount">        <div class="original-price">'+toPrice(t.Price,"{0} <span>{1}<\/span>")+'        <\/div>        <div class="discount-price" title="'+t.DiscountPercent+'% تخفیف">'+toPrice(t.Price-t.DiscountPrice,"{0} <span>{1} تخفیف<\/span>")+'        <\/div>    <\/div>    <div class="topay-price">'+toPrice(t.DiscountPrice,"{0} <span>{1}<\/span>")+"    <\/div><\/div>":'<div class="row"><div class="regular-price">'+toPrice(t.Price,"{0} <span>{1}<\/span>")+"<\/div><\/div>",r=p):(r=nt,i=""));h.html(i);d.html(r)}});$(".product-details .btn-add-cart").on("click",function(n){var h,f,c,o,u,s,t;n.preventDefault();h=$(this);window.productVarients?(f=$(".attr-op.selected"),c=$(".attr-op:not(.selected)"),f.length!=y.length?toastr.warning("لطفا نوع کالا را قبل از افزودن به سبد خرید مشخص کنید.","افزودن به سبد خرید"):(t=$(staticTemplates.Loading),e.append(t),o=[],u=[],f.each(function(){var t=$(this),n=t.closest(".row"),i=n.data("attributeid"),r=t.data("optionid");o.push(i+","+r);u.push(n.find("label").text()+n.find(".selected").text())}),_.each(productVarients,function(n){var t=!0;_.each(n.Attributes,function(n){o.indexOf(n.AttributeID+","+n.AttributeOptionID)==-1&&(t=!1)});t&&(s=n)}),$.ajax({type:"POST",url:"/Cart/Add",data:{ProductVarientID:s.ID},success:function(n){if(n.Success){var t=n.Data;t.Exists?toastr.warning("شما '"+i+" ("+u.join(" + ")+')\'  را به <a href="/Cart">سبد خرید<\/a> اضافه کرده اید.',"سبد خرید"):toastr.success("'"+i+" ("+u.join(" + ")+')\' به <a href="/Cart">سبد خرید<\/a> اضافه شد.',"سبد خرید");renderMiniCart(t)}else toastr.error(staticTexts.ResponseError,"سبد خرید")},error:function(){toastr.error(staticTexts.RequestError,"سبد خرید")},complete:function(){t.remove()}}))):(t=$(staticTemplates.Loading),e.append(t),$.ajax({type:"POST",url:"/Cart/Add",data:{ProductID:r},success:function(n){if(n.Success){var t=n.Data;t.Exists?toastr.warning("شما '"+i+'\'  را به <a href="/Cart">سبد خرید<\/a> اضافه کرده اید.',"سبد خرید"):toastr.success("'"+i+'\' به <a href="/Cart">سبد خرید<\/a> اضافه شد.',"سبد خرید");renderMiniCart(t)}else toastr.error(staticTexts.ResponseError,"سبد خرید")},error:function(){toastr.error(staticTexts.RequestError,"سبد خرید")},complete:function(){t.remove()}}))});n.on("click","a",function(t){var i,r;t.preventDefault();h.children("div").hide();n.find("a").removeClass("selected");i=$(this);i.addClass("selected");r=$(this).attr("href");$("html,body").animate({scrollTop:g.offset().top},600);$(r).show();$(window).resize()});tt.on("click","a",function(){var t=n.find('a[href="#ProductComments"]');t.click();$("html,body").animate({scrollTop:t.offset().top},600)});$(".product-accessories, .similar-products").each(function(){$(this).owlCarousel({autoplay:!0,loop:!0,items:1,smartSpeed:450,responsive:{0:{items:1},768:{items:2},1280:{items:4},1440:{items:5}}})});$(".btn-send-to-friend, .btn-send-score, .btn-add-request").magnificPopup({type:"inline",midClick:!0,removalDelay:300,mainClass:"mfp-fade"});c.sticky({topSpacing:0,bottomSpacing:900});c.on("sticky-start",function(){var n=$('<div class="hidden-title">').append($(".product-features h1").children().clone());$(this).children(".clear").before(n)});c.on("sticky-end",function(){$(this).children("div.hidden-title").remove()});e.on("click",".btn-wish",function(n){var t,u;n.preventDefault();t=$(staticTemplates.Loading);e.append(t);u=$(this).closest(".product-details");$.ajax({type:"POST",url:"/UserWishes/Add",data:{ProductID:r},success:function(n){if(n.Success){var t=n.Data;t.Login?t.Exists?toastr.warning("شما '"+i+'\'  را به <a href="/My-Account/My-Wishes">آرزوهای من<\/a> اضافه کرده اید.',"سبد خرید"):toastr.success("'"+i+'\' به <a href="/My-Account/My-Wishes">آرزوهای من<\/a> اضافه شد.',"آرزوی من"):toastr.warning('لطفا <a href="/ثبت-نام">ثبت نام<\/a> کنید یا <a href="/Login">وارد سایت<\/a> شوید.',"آرزوی من")}else toastr.error(staticTexts.ResponseError,"آرزوی من")},error:function(){toastr.error(staticTexts.RequestError,"آرزوی من")},complete:function(){t.remove()}})});ut.on("click",function(){o.hasClass("hide")&&(o.removeClass("hide").val(""),a.removeAttr("disabled").val(""),t.removeAttr("disabled").val(""),u.removeAttr("disabled"));$(".alert-request").remove();var n=$(staticTemplates.Loading);l.append(n);$.ajax({type:"POST",url:"/Products/GetUserInfo",success:function(n){if(n.Success){if(n.Data!=null){var i=n.Data;t.val(i.Email);u.val(i.Mobile)}}else toastr.error(staticTexts.ResponseError,"ارسال به دوست")},error:function(){toastr.error(staticTexts.RequestError,"ارسال به دوست")},complete:function(){n.remove()}})});o.on("click",function(n){if(n.preventDefault(),u.val()==""&&t.val()==""){toastr.error("لطفا شماره همراه یا ایمیل خود را وارد نمایید.");return}if(!validateEmail(t.val())){toastr.error("فرمت ایمیل نامعتبر است.");return}var i=$(staticTemplates.Loading);l.append(i);$.ajax({type:"POST",url:"/Products/AddRequest",data:{ProductID:r,Email:t.val(),Mobile:u.val(),Description:a.val()},success:function(n){n.Success?l.before('<div class="alert alert-success alert-request">درخواست شما با موفقیت ارسال شد.<\/div>'):toastr.error(staticTexts.ResponseError,"درخواست محصول")},error:function(){toastr.error(staticTexts.RequestError,"درخواست محصول")},complete:function(){i.remove();t.attr("disabled","disabled");u.attr("disabled","disabled");a.attr("disabled","disabled");o.addClass("hide")}})});$(".attributes").on("click","h3 a.group-title",function(n){n.preventDefault();var i=$(this).closest("h3"),t=i.next("ul");t.hasClass("close")?(t.removeClass("close"),i.removeClass("close")):(t.addClass("close"),i.addClass("close"));t.slideToggle()});s.on("click",function(){if(f.val()==""){toastr.error("لطفا ایمیل دوستتان را وارد نمایید.");return}if(!validateEmail(f.val())){toastr.error("فرمت ایمیل نامعتبر است.");return}var n=$(staticTemplates.Loading);b.append(n);$.ajax({type:"POST",url:"/Products/SendToFriend",data:{ID:r,FriendEmail:f.val(),Message:v.val()},success:function(n){n.Success?b.before('<div class="alert alert-success alert-sendtofriend">ایمیل شما با موفقیت ارسال شد.<\/div>'):toastr.error(staticTexts.ResponseError,"ارسال به دوست")},error:function(){toastr.error(staticTexts.RequestError,"ارسال به دوست")},complete:function(){n.remove();f.attr("disabled","disabled");v.attr("disabled","disabled");s.addClass("hide")}})});ft.on("click",function(){s.hasClass("hide")&&(f.removeAttr("disabled").val(""),v.removeAttr("disabled").val(""),s.removeClass("hide"));$(".alert-sendtofriend").remove()});$(".free-delivery").on("mouseenter",function(){var n=$(this);n.addClass("bounceIn")})});
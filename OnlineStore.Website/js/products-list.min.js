function refresh(n){loadProducts(n)}function loadProducts(n){var t=$(staticTemplates.Loading);$productslist.append(t);$("html, body").animate({scrollTop:$(".page-title-box").position().top});$.ajax({url:groupUrl,type:"POST",data:productsListOptions,success:function(t){var f,l,h,o,c,r,e,v,w,b;if(t.Success){f=t.Data;l=$productslist.find("ul");l.empty();h=f.Products;o=f.TotalPages;for(c in h){var r=h[c],i=$productItemTemplate.text(),a=getMinPrice(r),k=r.IsUnavailable,d=r.PriceStatus,y="";r.CommentCount>0&&(y="<a href='"+r.Url+"' class='comment'>"+r.CommentCount+" نظر<\/a>");i=i.replace(/{{ID}}/g,r.ID);i=i.replace(/{{Title}}/g,r.Title);i=i.replace(/{{Url}}/g,r.Url);i=i.replace(/{{ImageFile}}/g,r.ImageFile);i=i.replace(/{{DisplayTitle}}/g,r.DisplayTitle);i=i.replace(/{{DisplayTitleOther}}/g,r.ToolTip);i=i.replace(/{{ProductVarientID}}/g,r.HasVarients&&a!=undefined?a.ID:"");i=i.replace(/{{Price}}/g,renderPrice(a,k,d));i=i.replace(/{{ToolTip}}/g,r.ToolTip);i=i.replace(/{{QuickViewUrl}}/g,r.QuickViewUrl);i=i.replace(/{{CompareUrl}}/g,getCompareUrl(r.ID));i=i.replace(/{{CommentBox}}/g,y);i=i.replace(/{{GroupTitle}}/g,r.GroupTitle);i=i.replace(/{{GroupUrl}}/g,normalizeForUrl(r.GroupTitle_En));i=i.replace(/{{Score}}/g,renderScore(r.SumScore,r.ScoreCount,r.ProductScore));i=i.replace(/{{Marks}}/g,getMarks(r));l.append(i)}h.length==0?($alertEmpty.removeClass("hide"),$pagingBox.addClass("hide")):($alertEmpty.addClass("hide"),$pagingBox.removeClass("hide"));$paging.empty();var p=f.Paging,s=f.OriginalUrl,u=f.CurrentPageIndex,o=f.TotalPages;u>0&&$paging.append('<li class="page-prev">    <a href="'+s+"/"+u+'" data-index="'+u+'">        <i class="fa fa-chevron-right"><\/i>        قبلی    <\/a><\/li>');u-5>0&&$paging.append('<li class="page-last">    <a href="'+s+'/1" data-index="1">        1    <\/a><\/li>');u-6>0&&$paging.append('<li class="page-last">    <a href="'+s+"/"+(u-5)+'" data-index="'+(u-5)+'">        ...    <\/a><\/li>');for(c in p)r=p[c],u+1==r?$paging.append('<li class="current"> '+r+"<\/li>"):$paging.append('<li><a href="'+s+"/"+r+'" data-index="'+r+'">'+r+"<\/a><\/li>");o>u+7&&$paging.append('<li class="page-last">    <a href="'+s+"/"+(u+7)+'" data-index="'+(u+7)+'">        ...    <\/a><\/li>');o>u+6&&$paging.append('<li class="page-last">    <a href="'+s+"/"+o+'" data-index="'+o+'">'+o+"    <\/a><\/li>");o>u+1&&$paging.append('<li class="page-next">    <a href="'+s+"/"+(u+2)+'" data-index="'+(u+2)+'">        بعدی        <i class="fa fa-chevron-left"><\/i>    <\/a><\/li>');e=f.PageTitle;document.title=productsListOptions.PageTitle=e;v=e.replace(e.substr(e.lastIndexOf("-")-1,e.length-e.lastIndexOf("-")+1),"");$(".page-title h1").text(v);$(".breadcrumbs li:last span").text(v);w=f.CanonicalUrl;b=_.clone(productsListOptions);n&&history.pushState(b,e,w)}else toastr.error("رخداد خطا در نمایش محصولات","فیلتر محصولات")},error:function(){toastr.error("رخداد خطا در نمایش محصولات","فیلتر محصولات")},complete:function(){t.remove()}})}function getMinPrice(n){var t=n.Prices,i=undefined;return t!=null&&t.length>0&&(i=_.min(t,function(n){return n.Price})),i}function renderPrice(n,t,i){var r,t=t||!n||n.Price==0;if(t)switch(i){case 0:r='<div class="row">    <div class="price-isunavailable">        <i class="fa fa-times-circle"><\/i>        موجود نیست    <\/div><\/div>';break;case 1:r='<div class="row">    <div class="price-comingsoon">        <i class="fa fa-clock-o"><\/i>        به زودی    <\/div><\/div>';break;case 2:r='<div class="row">    <div class="price-contactus">        <i class="fa fa-phone"><\/i>        تماس بگیرید    <\/div><\/div>'}else n&&(r=n.DiscountPercent>0?'<div class="original-price">'+toPrice(n.Price,"{0} <span class='price-unit'>{1}<\/span>")+'<\/div><div class="topay-price">'+toPrice(n.DiscountPrice,"{0} <span class='price-unit'>{1}<\/span>")+"<\/div>":'<div class="regular-price">'+toPrice(n.Price,"{0} <span class='price-unit'>{1}<\/span>")+"<\/div>");return r}function renderScore(n,t,i){for(var r="",e=calcRaty(n,t,i),o=parseInt(e),s=e-o,u=0,f,r="<a href='#' class='rate'>",u=0;u<o;u++)r+="<img src='/assets/raty/images/star-on.png' />";for(s!=0&&(r+="<img src='/assets/raty/images/star-half.png' />",u++),f=0;f<5-u;f++)r+="<img src='/assets/raty/images/star-off.png' />";return r+"<\/a>"}function calcRaty(n,t,i){var r;return t==0&&i==0?0:(r=(n+i)/(t+1),r>5&&(r=5),r)}function getMarks(n){var t="",i,r;if(n.Marks){for(t="<div class='product_icon'>",i=0;i<n.Marks.length;i++)r=n.Marks[i],t+="<div class='mark' style='background-color:"+r.Color+"'><span>"+r.Title+"<\/span><\/div>";t+="<\/div>"}return t}var firstState=_.clone(productsListOptions),$productItemTemplate=$("#ProductItemTemplate"),$productslist=$(".products-list"),$pagingBox=$(".paging-box"),$paging=$(".paging"),$alertEmpty=$(".alert-empty"),filters=$(".filter-item input").on("change",function(){var t=$(this),n;productsListOptions.Producers=[];productsListOptions.Attributes=[];n=$(".filter-item input:checked");n.each(function(){var n=$(this),t=n.closest(".filter-item"),r=t.data("id"),u=n.closest("li"),i=u.data("id");t.is(".producers")?productsListOptions.Producers.push(i):productsListOptions.Attributes.push(r+"-"+i)});productsListOptions.PageIndex=1;refresh(!0)});$(".btn-more").on("click",function(n){n.preventDefault();var t=$(this),i=t.prev();i.hasClass("open")?(i.removeClass("open").animate({height:"154px"},{complete:function(){$(window).resize()}}),t.text("+ بیشتر")):(i.addClass("open").css({height:"100%"}),$(window).resize(),t.text("- کمتر"))});$paging.on("click","a",function(n){n.preventDefault();var t=$(this),i=t.data("index");productsListOptions.PageIndex=i;refresh(!0)});$(window).on("popstate",function(n){var t=n.originalEvent.state;t||(t=_.clone(firstState));productsListOptions=t;$(".filter-item input:checkbox").prop("checked",!1);_.each(productsListOptions.Producers,function(n){$('.producers li[data-id="'+n+'"] input:checkbox').prop("checked",!0)});_.each(productsListOptions.Attributes,function(n){var t=n.split("-")[0],i=n.split("-")[1];$('.filter-item[data-id="'+t+'"] li[data-id="'+i+'"] input:checkbox').prop("checked",!0)});refresh(!1)});
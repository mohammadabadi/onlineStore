$(function(){function h(){var n=$(this);r.val()=="468"?($("#SendType_0").prop({checked:!0,disabled:!1}),$("#SendType_1, #SendType_2").prop({checked:!1,disabled:!0}),$("#PaymentType_2").prop({disabled:!1})):($("#SendType_0").prop({checked:!1,disabled:!0}),$("#SendType_1").prop({disabled:!1,checked:!0}),$("#SendType_2").prop({disabled:!1}),$("#PaymentType_2").prop({checked:!1,disabled:!0}),$("#PaymentType_0, #PaymentType_1").is(":checked")||$("#PaymentType_0").prop({checked:!0}))}var t=$(".btn-nextstep"),i=$(".btn-prevstep"),n=1,f=$(".steps-box"),e=$(".user-info"),c=$(".methods"),l=$(".cart-box"),o=$("#Payment"),nt=$(".btn-pay"),tt=$("#BankMellat"),it=$(".sendtype"),a=$(".paymenttype"),v=$("#Firstname"),y=$("#Lastname"),p=$("#Email"),w=$("#Phone"),b=$("#Mobile"),s=$(".delivery-info"),k=$("#PostalCode"),d=$("#HomeAddress"),g=$("#UserDescription"),u=$("#States"),r=$("#Cities");t.on("click",function(h){var ut,rt,tt,nt,it;if(h.preventDefault(),ut=$(this),n==2||n==3){if(!o.valid())return;n==2&&(rt=parseInt($(".step-content-1 .total-topay").data("price")),isFreeDelivery(rt)?s.text(staticTexts.MaxPriceFreeDelivery):s.text("هزینه ثابت 10 هزار تومان"));copyCart()}else if(n==4){tt=$(staticTemplates.Loading);l.append(tt);nt={SendMethodType:$(".sendtype").find(":checked").val(),PaymentMethodType:$(".paymenttypes").find(":checked").val(),UserDescription:g.val()};isAuthenticated||(nt.Firstname=v.val(),nt.Lastname=y.val(),nt.Email=p.val(),nt.Phone=w.val(),nt.Mobile=b.val(),nt.StateID=u.val(),nt.CityID=r.val(),nt.PostalCode=k.val(),nt.HomeAddress=d.val());$.ajax({type:"POST",url:"/Cart/Payment",data:nt,success:function(r){if(r.Success){var u=r.Data;nt.PaymentMethodType==0?(window.location.href=u,toastr.success("در حال ارسال به بانک","پرداخت سبد خرید")):(nt.PaymentMethodType==1||nt.PaymentMethodType==2)&&(toastr.success("اطلاعات شما با موفقیت ثبت شد.","ثبت سفارش"),n++,$(".step-content").hide(),$(".step-content-"+n).show(),f.find(".btn-step").removeClass("active").eq(n-1).addClass("active").prevAll().addClass("success"),t.hide(),i.hide(),nt.PaymentMethodType==1?($(".step-content-5 .price").html(toPrice(u.ToPayPrice,'{0} <span class="price-unit">{1}<\/span>')),$(".step-content-5 .type_1").show(),$(".step-content-5 .type_2").hide()):nt.PaymentMethodType==2&&($(".step-content-5 .type_2").show(),$(".step-content-5 .type_1").hide()))}else toastr.error(staticTexts.ResponseError,"پرداخت سبد خرید")},error:function(){toastr.error(staticTexts.RequestError,"پرداخت سبد خرید")},complete:function(){tt.remove()}});return}if(n++,$(".step-content").hide(),$(".step-content-"+n).show(),f.find(".btn-step").removeClass("active").eq(n-1).addClass("active").prevAll().addClass("success"),n==2)t.find("span").text("دریافت اطلاعات پستی"),i.find("span").text("مشاهده سبد خرید"),t.show(),i.show();else if(n==3)t.find("span").text("پرداخت سبد خرید"),i.find("span").text("دریافت اطلاعات شخصی"),t.show(),i.show();else if(n==4)it="",it=a.find(":checked").val()=="0"?"ارسال به بانک":"ثبت سفارش",t.find("span").text(it),i.find("span").text("دریافت اطلاعات پستی"),t.show(),i.show();else{if(isAuthenticated){if(e.find("i").hasClass("fa-times-circle")){toastr.error("لطفا اطلاعات خود را تکمیل نمایید");return}}else{if(!o.valid())return;if(u.val()==-1||r.val()==-1){toastr.error("تکمیل فیلد استان و شهر الزامی است");return}}e.hide();c.show()}});i.on("click",function(r){r.preventDefault();n--;$(".step-content").hide();$(".step-content-"+n).show();f.find(".btn-step").removeClass("active success").eq(n-1).addClass("active").prevAll().addClass("success");n==1&&(t.find("span").text("دریافت اطلاعات شخصی"),i.find("span").text("مشاهده سبد خرید"),t.show(),i.hide());n==2?(t.find("span").text("دریافت اطلاعات پستی"),i.find("span").text("مشاهده سبد خرید"),t.show(),i.show()):n==3&&(t.find("span").text("پرداخت سبد خرید"),i.find("span").text("دریافت اطلاعات شخصی"),t.show(),i.show())});u.val("");r.val("");u.on("change",h);r.on("change",h).change()});
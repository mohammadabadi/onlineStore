function renderMiniCart(n){var i,t,r,f,u;cartItems=n.CartItems;$cartItems.empty();$cartCount.text(n.CartItems.length);n.CartItems.length==0?($cartEmpty.removeClass("hide"),$totalTopay.eq(1).html('<span class="cart-empty">تجربه خرید مطمئن...<\/span>'),$cartBox.addClass("hide"),$stepsBox.addClass("hide"),$cartAlert.removeClass("hide")):($cartEmpty.addClass("hide"),$cartAlert.addClass("hide"));for(r in n.CartItems){i=n.CartItems[r];t=miniCartTemplate;for(r in i)f=new RegExp("{{"+r+"}}","g"),t=t.replace(f,i[r]);t=$(t);i.DiscountPrice==0?t.find(".price-box").html('<div class="regular-price">'+toPrice(i.Price,"{0} <span>{1}<\/span>")+"<\/div>"):t.find(".price-box").html('<div class="original-price">'+toPrice(i.Price,"{0} <span>{1}<\/span>")+'<\/div><div class="discount-price">'+toPrice(i.DiscountPrice,"{0} <span>{1}<\/span>")+"<\/div>");$cartItems.append(t)}$totalPrice.html(toPrice(n.Total,'{0} <span class="price-unit">{1}<\/span>'));$totalTopay.html(toPrice(n.TotalDiscount,'{0} <span class="price-unit">{1}<\/span>'));$totalTopay.attr("data-price",n.TotalDiscount);u=n.Total-n.TotalDiscount;u==0?$(".total-profit-row").addClass("hide"):($(".total-profit-row").removeClass("hide"),$totalProfit.html(toPrice(u,'{0} <span class="price-unit">{1}<\/span>')));copyCart()}function copyCart(){var n=$($(".step-content-1").html());n.find(".btn-quantity-down, .btn-quantity-up, .btn-cart-remove").remove();n.find("th:last").html("");var i=n.find(".total-topay").data("price"),t=-1,r=$sendtype.find(":checked").val();switch(r){case"0":t=5e4;break;case"1":t=1e5;break;case"2":t=1e5}isFreeDelivery(i)&&(t=0);n.find(".delivary-price-row").removeClass("hide");t>0?(n.find(".delivary-price").html(toPrice(t,'{0} <span class="price-unit">{1}<\/span>')),n.find(".total-topay").html(toPrice(i+t,'{0} <span class="price-unit">{1}<\/span>'))):r!="0"&&isFreeDelivery(i)?n.find(".delivary-price").html(staticTexts.MaxPriceFreeDelivery):n.find(".delivary-price").html("رایگان");$(".step-content-4").html("").append(n)}var miniCartTemplate=$("#MiniCartTemplate").text();$("body").on("click",".btn-minicart-remove",function(n){var f;n.preventDefault();n.stopPropagation();var o=$(this),i=o.closest(".cart-item"),e=i.find("h2").text(),r=i.data("productid"),t=i.data("productvarientid"),u=i.data("packageid");t=="{{ProductVarientID}}"&&(t=undefined);r=="{{ProductID}}"&&(r=undefined);u=="{{PackageID}}"&&(u=undefined);f=$(staticTemplates.Loading);i.append(f);$.ajax({type:"POST",url:"/Cart/Remove",data:{ProductVarientID:t,ProductID:r,PackageID:u},success:function(n){if(n.Success){var i=n.Data;i.Exists?toastr.success("'"+e+'\' از <a href="/Cart">سبد خرید<\/a> حذف شد.',"سبد خرید"):toastr.warning("شما '"+e+'\'  را از <a href="/Cart">سبد خرید<\/a> حذف کرده اید.',"سبد خرید");r&&$('tr[data-productid="'+r+'"]').remove();t&&$('tr[data-productvarientid="'+t+'"]').remove();t&&$('tr[data-packageid="'+t+'"]').remove();renderMiniCart(i)}else toastr.error(staticTexts.ResponseError,"سبد خرید")},error:function(){toastr.error(staticTexts.RequestError,"سبد خرید")},complete:function(){f.remove()}})});$("body").on("click",".btn-cart-remove",function(n){n.preventDefault();n.stopPropagation();var e=$(this),t=e.closest("tr"),i=t.data("productid"),r=t.data("productvarientid"),u=t.find(".product-url").text(),f=$(staticTemplates.Loading);t.append(f);$.ajax({type:"POST",url:"/Cart/Remove",data:{ProductID:i,ProductVarientID:r},success:function(n){if(n.Success){var t=n.Data;t.Exists?toastr.success("'"+u+'\' از <a href="/Cart">سبد خرید<\/a> حذف شد.',"سبد خرید"):toastr.warning("شما '"+u+'\'  را از <a href="/Cart">سبد خرید<\/a> حذف کرده اید.',"سبد خرید");i&&$('tr[data-productid="'+i+'"]').remove();r&&$('tr[data-productvarientid="'+r+'"]').remove();renderMiniCart(t)}else toastr.error(staticTexts.ResponseError,"سبد خرید")},error:function(){toastr.error(staticTexts.RequestError,"سبد خرید")},complete:function(){f.remove()}})});$(".products-box, .products-list-box, .similar-products-box").on("click",".btn-add-cart",function(n){var f;n.preventDefault();var e=$(this),t=e.closest("li"),i=t.find("h2").text(),o=t.data("productid"),r=t.data("productvarientid"),u={};if(t.find(".price-isunavailable").length>0){toastr.warning("'"+i+"' موجود نمی باشد.","سبد خرید");return}if(t.find(".price-comingsoon").length>0){toastr.info("'"+i+"' به زودی ارائه می شود.","سبد خرید");return}if(t.find(".price-contactus").length>0){toastr.info("برای اطلاع از موجودی '"+i+"' تماس بگیرید.","سبد خرید");return}if(r==-1){toastr.error("اطلاعات محصول ناقص است.","سبد خرید");return}r==""?u.ProductID=o:u.ProductVarientID=r;f=$(staticTemplates.Loading);t.append(f);$.ajax({type:"POST",url:"/Cart/Add",data:u,success:function(n){if(n.Success){var t=n.Data;if(!t.CanAdd){toastr.error("'"+i+"' موجود نمی باشد.","سبد خرید");return}t.Exists?toastr.warning("شما '"+i+'\'  را به <a href="/Cart">سبد خرید<\/a> اضافه کرده اید.',"سبد خرید"):toastr.success("'"+i+'\' به <a href="/Cart">سبد خرید<\/a> اضافه شد.',"سبد خرید");renderMiniCart(t)}else toastr.error(staticTexts.ResponseError,"سبد خرید")},error:function(){toastr.error(staticTexts.RequestError,"سبد خرید")},complete:function(){f.remove()}})});var $miniCart=$(".mini-cart"),$cartItems=$(".cart-items"),$cartCount=$(".basket-count-box span"),$cartEmpty=$(".cart-empty"),$cartBox=$(".cart-box"),$stepsBox=$(".steps-box"),$cartAlert=$(".cart-alert-empty"),$totalPrice=$(".mini-cart .total-price .price, .cart-box .total-price"),$totalProfit=$(".mini-cart .total-profit .price, .cart-box .total-profit"),$totalTopay=$(".mini-cart .total-topay .price, .cart-box .total-topay, .mini-cart .totalprice"),$sendtype=$(".sendtype"),$paymenttype=$(".paymenttype"),$cart=$(".cart");$(".mini-cart .dropdown-toggle").on("click",function(n){var t=$(this);t.find(".cart-count").text()==0&&(n.preventDefault(),n.stopPropagation(),toastr.warning("سبد خرید شما خالی است.","سبد خرید"))});$("body").on("click",".btn-quantity-down, .btn-quantity-up",function(n){var f;n.preventDefault();var e=$(this),i=e.closest("tr"),r=i.find(".quantity"),t=r.val(),o=i.data("productid"),s=i.data("productvarientid"),u=-1;t=parseInt(t);t>0?(u=t,e.hasClass("btn-quantity-up")?t++:t>1&&t--):t=1;r.val(t);f=$(staticTemplates.Loading);i.append(f);$.ajax({type:"POST",url:"/Cart/Changed",data:{productID:o,productVarientID:s,Quantity:t},success:function(n){if(n.Success){var e=n.Data,l=_.find(e.CartItems,function(n){return n.ProductID==o}),a=_.find(e.CartItems,function(n){return n.ProductVarientID==s}),t;l&&(t=l);a&&(t=a);var h=i.find(".price-item"),c=i.find(".total-item"),f='{0} <span class="price-unit">{1}<\/span>';t.DiscountPrice>0?(h.find(".original-price").html(toPrice(t.DiscountPrice,f)),h.find(".discount-price").html(toPrice(t.Price,f)),c.find(".original-price").html(toPrice(t.Quantity*t.DiscountPrice,f)),c.find(".discount-price").html(toPrice(t.Quantity*t.Price,f))):(h.find(".regular-price").html(toPrice(t.Price,f)),c.find(".regular-price").html(toPrice(t.Quantity*t.Price,f)));renderMiniCart(e)}else r.val(u),toastr.error(staticTexts.ResponseError,"سبد خرید")},error:function(){r.val(u);toastr.error(staticTexts.RequestError,"سبد خرید")},complete:function(){f.remove()}})});
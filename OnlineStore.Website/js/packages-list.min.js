function refresh(n){loadProducts(n)}function loadProducts(n){var t=$(staticTemplates.Loading);$productslist.append(t);$("html, body").animate({scrollTop:$(".page-title-box").position().top});$.ajax({url:"/Packages/",type:"POST",data:productsListOptions,success:function(t){var f,c,s,e,h,i,a,v;if(t.Success){f=t.Data;c=$productslist.find("ul");c.empty();s=f.Packages;e=f.TotalPages;for(h in s){var i=s[h],u=$productItemTemplate.text(),y=i.NewPrice*100/i.OldPrice;u=u.replace(/{{ID}}/g,i.ID);u=u.replace(/{{Title}}/g,i.Title);u=u.replace(/{{Url}}/g,i.Url);u=u.replace(/{{ImageFile}}/g,i.ImageFile);u=u.replace(/{{Price}}/g,renderPrice(i.OldPrice,i.NewPrice,y));u=u.replace(/{{ToolTip}}/g,i.Title);u=u.replace(/{{Score}}/g,renderScore(i.PackageScore));c.append(u)}s.length==0?($alertEmpty.removeClass("hide"),$pagingBox.addClass("hide")):($alertEmpty.addClass("hide"),$pagingBox.removeClass("hide"));$paging.empty();var l=f.Paging,o="/Packages",r=f.CurrentPageIndex,e=f.TotalPages;r>0&&$paging.append('<li class="page-prev">    <a href="'+o+"/"+r+'" data-index="'+r+'">        <i class="fa fa-chevron-right"><\/i>        قبلی    <\/a><\/li>');r-5>0&&$paging.append('<li class="page-last">    <a href="'+o+'/1" data-index="1">        1    <\/a><\/li>');r-6>0&&$paging.append('<li class="page-last">    <a href="'+o+"/"+(r-5)+'" data-index="'+(r-5)+'">        ...    <\/a><\/li>');for(h in l)i=l[h],r+1==i?$paging.append('<li class="current"> '+i+"<\/li>"):$paging.append('<li><a href="'+o+"/"+i+'" data-index="'+i+'">'+i+"<\/a><\/li>");e>r+7&&$paging.append('<li class="page-last">    <a href="'+o+"/"+(r+7)+'" data-index="'+(r+7)+'">        ...    <\/a><\/li>');e>r+6&&$paging.append('<li class="page-last">    <a href="'+o+"/"+e+'" data-index="'+e+'">'+e+"    <\/a><\/li>");e>r+1&&$paging.append('<li class="page-next">    <a href="'+o+"/"+(r+2)+'" data-index="'+(r+2)+'">        بعدی        <i class="fa fa-chevron-left"><\/i>    <\/a><\/li>');a=f.PageTitle;document.title=productsListOptions.PageTitle=a;v=_.clone(productsListOptions);n&&history.pushState(v,"",r+1)}else toastr.error("رخداد خطا در نمایش محصولات","فیلتر محصولات")},error:function(){toastr.error("رخداد خطا در نمایش محصولات","فیلتر محصولات")},complete:function(){t.remove()}})}function renderPrice(n,t,i){return i>0?'<div class="original-price">'+toPrice(n,"{0} <span class='price-unit'>{1}<\/span>")+'<\/div><div class="topay-price">'+toPrice(t,"{0} <span class='price-unit'>{1}<\/span>")+"<\/div>":'<div class="regular-price">'+toPrice(n,"{0} <span class='price-unit'>{1}<\/span>")+"<\/div>"}function renderScore(n){for(var t="",f=n,u=parseInt(n),e=f-u,i=0,r,t="<a href='#' class='rate'>",i=0;i<u;i++)t+="<img src='/assets/raty/images/star-on.png' />";for(e!=0&&(t+="<img src='/assets/raty/images/star-half.png' />",i++),r=0;r<5-i;r++)t+="<img src='/assets/raty/images/star-off.png' />";return t+"<\/a>"}var firstState=_.clone(productsListOptions),$productItemTemplate=$("#ProductItemTemplate"),$productslist=$(".products-list"),$pagingBox=$(".paging-box"),$paging=$(".paging"),$alertEmpty=$(".alert-empty");$paging.on("click","a",function(n){n.preventDefault();var t=$(this),i=t.data("index");productsListOptions.PageIndex=i;refresh(!0)});